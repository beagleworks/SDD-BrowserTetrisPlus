# 実装計画

- [ ] 1. プロジェクト構造とHTML基盤の作成
  - HTMLファイル、CSSファイル、TypeScriptファイルの基本構造を作成
  - TypeScript設定ファイル（tsconfig.json）の作成
  - Canvas要素とUI要素の配置
  - 基本的なスタイリングの実装
  - _要件: 8.1, 8.2, 8.3, 8.5_

- [ ] 2. ブロック定義システムの実装
  - [ ] 2.1 TypeScript型定義とブロック定義のTDD実装
    - RED: ブロック型定義の失敗テストを作成
    - GREEN: TypeScript型定義ファイル（types.ts）を最小限で作成
    - REFACTOR: 11種類のブロック定義を段階的に追加
    - RED: ブロック回転の失敗テストを作成
    - GREEN: ブロック回転機能を純粋関数として最小実装
    - REFACTOR: 回転機能の改善とエッジケース対応
    - _要件: 2.1-2.12_

  - [ ] 2.2 BlockSystemモジュールのTDD実装
    - RED: ランダムブロック生成の失敗テストを作成
    - GREEN: 最小限のランダムブロック生成機能を実装
    - REFACTOR: ブロック生成ロジックの改善
    - RED: 次ブロック管理の失敗テストを作成
    - GREEN: 基本的な次ブロック管理機能を実装
    - REFACTOR: ブロック管理機能の完成
    - _要件: 2.1-2.12, 5.1, 5.2_

- [ ] 3. ゲームフィールドとレンダリングシステムの実装
  - [ ] 3.1 GameFieldモジュールのTDD実装
    - RED: ゲームフィールド作成の失敗テストを作成
    - GREEN: 20×10の基本ゲームフィールドを2次元配列で最小実装
    - REFACTOR: フィールド作成機能の改善
    - RED: ブロック配置の失敗テストを作成
    - GREEN: 基本的なブロック配置機能を純粋関数として実装
    - REFACTOR: 境界チェック機能を純粋関数として追加
    - _要件: 8.1_

  - [ ] 3.2 基本レンダリング機能のTDD実装
    - RED: Canvas描画の失敗テストを作成（モック使用）
    - GREEN: 基本的なCanvas描画機能を関数として最小実装
    - REFACTOR: 描画機能の改善
    - RED: ゲームフィールド描画の失敗テストを作成
    - GREEN: フィールド描画機能を純粋関数として実装
    - REFACTOR: ブロック描画機能を純粋関数として追加（色分けを含む）
    - _要件: 8.1, 8.2, 8.3, 8.4, 2.12_

- [ ] 4. 衝突検出システムのTDD実装
  - RED: 境界衝突検出の失敗テストを作成
  - GREEN: 基本的な境界衝突検出を純粋関数として最小実装
  - REFACTOR: 境界衝突検出の改善
  - RED: ブロック間衝突検出の失敗テストを作成
  - GREEN: ブロック間衝突検出を純粋関数として実装
  - REFACTOR: 衝突検出アルゴリズム全体の最適化
  - _要件: 1.5_

- [ ] 5. 基本的なブロック操作の実装
  - [ ] 5.1 ブロック移動機能のTDD実装
    - RED: 左右移動の失敗テストを作成
    - GREEN: 基本的な左右移動機能を純粋関数として最小実装
    - REFACTOR: 移動機能の改善
    - RED: 下方向移動の失敗テストを作成
    - GREEN: 下方向移動機能を純粋関数として実装
    - REFACTOR: 移動時の衝突チェックを統合
    - _要件: 1.1, 1.2, 1.3, 1.5_

  - [ ] 5.2 ブロック回転機能のTDD実装
    - RED: 時計回りの回転の失敗テストを作成
    - GREEN: 基本的な回転機能を純粋関数として最小実装
    - REFACTOR: 回転機能の改善
    - RED: 回転時の衝突チェックの失敗テストを作成
    - GREEN: 回転時の衝突チェックを統合
    - REFACTOR: 回転機能の完成
    - _要件: 1.4, 1.5_

- [ ] 6. 入力処理システムのTDD実装
  - RED: キーボード入力処理の失敗テストを作成（モック使用）
  - GREEN: 基本的なキー入力処理を純粋関数として最小実装（矢印キー、スペースキー）
  - REFACTOR: 入力処理機能の改善
  - RED: 入力とブロック操作連携の失敗テストを作成
  - GREEN: 入力とブロック操作の連携を関数合成で実装
  - REFACTOR: InputHandlerモジュール全体の最適化
  - _要件: 1.1, 1.2, 1.3, 1.4_

- [ ] 7. ゲームループとブロック自動落下の実装
  - [ ] 7.1 基本ゲームループのTDD実装
    - RED: ゲームループの失敗テストを作成（モック使用）
    - GREEN: requestAnimationFrameを使用した基本ゲームループを関数型アプローチで最小実装
    - REFACTOR: ゲームループの改善
    - RED: 固定タイムステップ更新の失敗テストを作成
    - GREEN: 固定タイムステップの更新処理を純粋関数として実装
    - REFACTOR: ゲームループ全体の最適化
    - _要件: 4.4_

  - [ ] 7.2 ブロック自動落下機能のTDD実装
    - RED: タイマーベース自動落下の失敗テストを作成
    - GREEN: 基本的な自動落下を純粋関数として最小実装
    - REFACTOR: 自動落下機能の改善
    - RED: レベル別落下速度の失敗テストを作成
    - GREEN: レベルに応じた落下速度調整を純粋関数として実装
    - REFACTOR: 自動落下機能の完成
    - _要件: 4.4_

- [ ] 8. ライン消去システムの実装
  - [ ] 8.1 ライン検出機能のTDD実装
    - RED: 完成ライン検出の失敗テストを作成
    - GREEN: 基本的な完成ライン検出アルゴリズムを純粋関数として最小実装
    - REFACTOR: ライン検出機能の改善
    - RED: 複数ライン同時検出の失敗テストを作成
    - GREEN: 複数ライン同時検出機能を純粋関数として実装
    - REFACTOR: ライン検出機能の完成
    - _要件: 3.1_

  - [ ] 8.2 ライン消去とブロック落下のTDD実装
    - RED: ライン消去の失敗テストを作成
    - GREEN: 基本的なライン消去機能を純粋関数として最小実装
    - REFACTOR: ライン消去機能の改善
    - RED: 上部ブロック落下の失敗テストを作成
    - GREEN: 上部ブロックの落下処理を純粋関数として実装
    - REFACTOR: ライン消去システム全体の最適化
    - _要件: 3.1, 3.2_

- [ ] 9. スコアとレベル管理システムの実装
  - [ ] 9.1 ScoreManagerモジュールのTDD実装
    - RED: スコア計算の失敗テストを作成（1-4ライン消去パターン）
    - GREEN: 基本的なスコア計算機能を純粋関数として最小実装
    - REFACTOR: スコア計算機能の改善
    - RED: レベル管理の失敗テストを作成
    - GREEN: レベル管理機能を純粋関数として実装
    - REFACTOR: ライン数カウント機能を純粋関数として追加
    - _要件: 3.3, 3.4, 3.5, 3.6, 4.1, 4.2, 4.3, 4.5_

  - [ ] 9.2 UI表示機能のTDD実装
    - RED: UI表示の失敗テストを作成（モック使用）
    - GREEN: 基本的なスコア、レベル、ライン数表示機能を純粋関数として最小実装
    - REFACTOR: UI表示機能の改善
    - RED: リアルタイム更新の失敗テストを作成
    - GREEN: リアルタイム更新機能を関数型アプローチで実装
    - REFACTOR: UI表示システム全体の最適化
    - _要件: 4.1, 4.2, 4.5_

- [ ] 10. プレビューとスキップ機能の実装
  - [ ] 10.1 次ブロックプレビューのTDD実装
    - RED: プレビューエリア描画の失敗テストを作成
    - GREEN: 基本的なプレビューエリア描画機能を純粋関数として最小実装
    - REFACTOR: プレビュー描画機能の改善
    - RED: 次ブロック表示の失敗テストを作成
    - GREEN: 次ブロックの表示機能を純粋関数として実装
    - REFACTOR: プレビュー更新機能を純粋関数として追加
    - _要件: 5.1, 5.2, 5.3_

  - [ ] 10.2 スキップ機能のTDD実装
    - RED: スキップスタック管理の失敗テストを作成
    - GREEN: 基本的なスキップスタック管理機能を純粋関数として最小実装
    - REFACTOR: スキップスタック管理の改善
    - RED: スキップ操作処理の失敗テストを作成
    - GREEN: スキップ操作の処理を純粋関数として実装
    - REFACTOR: スキップスタック回復機能とスタック数表示機能を純粋関数として追加
    - _要件: 5.4, 5.5, 5.6, 5.7, 5.8, 5.9_

- [ ] 11. ゲーム状態管理の実装
  - [ ] 11.1 ゲームオーバー処理のTDD実装
    - RED: ゲームオーバー判定の失敗テストを作成
    - GREEN: 基本的なゲームオーバー判定機能を純粋関数として最小実装
    - REFACTOR: ゲームオーバー判定の改善
    - RED: ゲームオーバー画面表示の失敗テストを作成
    - GREEN: ゲームオーバー画面の表示機能を純粋関数として実装
    - REFACTOR: 新しいゲーム開始機能を純粋関数として追加
    - _要件: 6.1, 6.2, 6.3, 6.4_

  - [ ] 11.2 ポーズ機能のTDD実装
    - RED: ポーズ状態管理の失敗テストを作成
    - GREEN: 基本的なポーズ状態の管理機能を純粋関数として最小実装
    - REFACTOR: ポーズ状態管理の改善
    - RED: ポーズ画面表示の失敗テストを作成
    - GREEN: ポーズ画面の表示機能を純粋関数として実装
    - REFACTOR: ポーズ/再開の入力処理を純粋関数として追加
    - _要件: 7.1, 7.2, 7.3, 7.4_

- [ ] 12. 統合とテスト
  - [ ] 12.1 全機能の統合（Outside-In TDD）
    - RED: ゲーム全体の統合テストを作成（End-to-Endシナリオ）
    - GREEN: すべてのモジュールを関数合成で統合し、基本動作を実現
    - REFACTOR: 統合部分の最適化とエラーハンドリング強化
    - 統合テストの実行と検証
    - _要件: 全要件_

  - [ ] 12.2 ユーザビリティとパフォーマンステスト（TDD継続）
    - RED: パフォーマンス要件の失敗テストを作成（60FPS、応答性）
    - GREEN: 基本的なパフォーマンス要件を満たす実装
    - REFACTOR: パフォーマンス最適化とキー操作応答性の改善
    - 長時間プレイでの安定性テストの実行
    - _要件: 8.5_

- [ ] 13. 最終調整とポリッシュ（TDD継続）
  - RED: 視覚効果の失敗テストを作成（ライン消去エフェクトなど）
  - GREEN: 基本的な視覚効果を純粋関数として最小実装
  - REFACTOR: 視覚効果の改善と音響効果の関数型アプローチでの実装（オプション）
  - モバイル対応の最終調整とテスト
  - 最終的な動作確認とリファクタリング
  - _要件: 8.4, 8.5_